---
output:
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Effects of a Defaunation Gradient on Tropical Forest Structure in Ivindo National Park, Gabon"
subtitle: "https://github.com/israelgolden/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject"
author: "Tashsa Griffiths, Israel Golden, Aubrey Knier, and Mishka Malinowski"
fontsize: 12pt
mainfont: Times New Roman
always_allow_html: true

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
setwd("../GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject")

# Load your packages
library(tidyverse)
library(ggplot2)
library(sf)
library(leaflet)
library(mapview)
library(lubridate)
library(RColorBrewer)
library(raster)
library(formatR)

# Set your ggplot theme
mytheme <- theme_light() +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)

# Load your datasets
raw.data <- read.csv("./Data/Raw/Data_USE_ME.csv")

# Load spatial files
Africa <- st_read('./Data/Spatial Files/Africa/afr_g2014_2013_0.shp')
Parks <- st_read('./Data/Spatial Files/Gabon/National Parks/NP_PresRes.shp')
Rivers <- st_read('./Data/Spatial Files/Gabon/Stream/GAB_hydro_lineaire_principal_2013/GAB_hydro_lineaire_principal_2013.shp')
Roads <- st_read('./Data/Spatial Files/Gabon/Roads/GAB_major_roads_2013.shp')
Makokou <- read_csv('./Data/Spatial Files/Gabon/Makokou_Coordinates.csv')
Plots <- st_read('./Data/Spatial Files/Gabon/Plots/Plots with species/plots_with_species.shp')

```


# **Rationale and Research Questions**

Tropical forests throughout the world are experiencing changes in forest structure and ecosystem services due to increasing hunting pressure, resulting in plummeting animal populations^1^. This phenomenon known as defaunation has cascading effects throughout ecosystems due to the disruption of intricate plant-animal interactions that are responsible for shaping tropical forests^1^. Plant-animal interactions such as seed dispersal, seed predation, trampling, herbivory, and nutrient translocation are necessary to shape forests. Through positive interactions such as the distribution of seeds and nutrients and antagonistic interactions such as herbivory and trampling - resulting in the opening up of the understory, plant-animal interactions create opportunities for a variety of species to succeed in the forest and increase plant diversity, richness, and ecosystem services^2^. For example, in the Afrotropical forests of LuiKotale in the Congo Basin, 95% of the trees in this area depend on animals for dispersal demonstrating the necessity of plant-animal interactions in these systems^3^. The alteration or loss of faunal communities in tropical forests has led to "Empty Forest Syndrome", where a forest appears to be intact, but the animal community is so depleated or non-existent that the forest no longer functions as it did resulting in changes in ecosystem services, such as carbon storage^4^. 

As defaunation continues to increase globally, there is little understanding of the long-term effects of defaunation on tropical forest diversity, ecosystem services and specifically carbon storage capabilities. Tropcial forests are responsible for sequestering ~40% of the world's aboveground carbon^4^. Therefore, the effects of defaunation on tropical forests may have detrimental effects for global carbon storage and climate change projections. Further research is necessary to understand the intricate interactions between defaunation, tropical forests, and ecosystem services to illuminate these relationships and advocate for policy changes and resource management. However, it is essential to highlight that the underlying causes of defaunation are top-down driven by the global economy, government regulations and incentives, access to income and livelihoods,and ultimately quality of life. 

## **Research Questions** 





\newpage

# Dataset Information

This dataset if provided by the Pouslen Tropical Ecology Lab here at Duke. yadda yadda...

...briefly explain what the project is / what the data are...

The dimensions and variable information of the raw dataset are below:
```{r dataset info, echo=F, eval=T}
dim(raw.data)
```

Column name | Description | Unit | Range (if applicable)
--------|----------------|--------|--------
E | Field expedition season | Season-Year | Winter - Summer 2021
Data_entry | Name of individual inputting data to Excel | Name | 
Date..dd.mm.yyyy. | Date of Excel data entry | Date/Month/Year | March 2021 - November 2022 
File_name | Photo file name of field data sheet | .JPG |
Date..dd.mm.yyyy..1 | Data of field data collection | Date/Month/Year | June - January 2021
Note_taker | Name of individual recording field data | Name |
Project | Defaunated forest (DF) or intact forest (IF) plot | Category | DF or IF
Plot | Unique plot identification | Category | 1A, 1B, 2A, 2B, 3A, 3B, 4A, 4B, 5A, 5B, 6A, 6B
Grid | Within-plot grid where data were collected | Category | 
TAG_SUM | The most unique identifier, using plot grid and plant tag | Category | 
Plant_tag | Identifer assigned to each sample | Letter-Number Combination | 
X_coord | X coordinate of sample location | Degrees | 0.00 - 9.80
Y_coord | Y coordinate of sample location | Degrees | 0.00 - 8.75
Tool | Tool used to measure diameter (DBH or caliper (CP)) | Category | DBH or CP
POM | Point of measurement for diameter | Meters | 0.00 - 11.00
DBH.mm | Diameter at breast height (DBH) | Millimeters | 0.00 - 173.00
Height..meters. | Height of plant | Meters | 0.07 - 70.00
Type_Field | Vegetation type or size class of plant | Category | Seedling, Sapling, Liana, Tree
Note_Field | Miscellaneous field notes | Phrase | 
ID | Latin species identification | Name | 
Treatment | Future plot treatments (fungicide/insecticide)| Category | LMC, LME, MME, MMC

With such a large dataset, data cleaning and wrangling was an essential process for creating a manageable dataset that was relevant for answering our research questions. First, we subset our selected six plots for our analysis:
```{r load and subset data, include=F}
#DATA CLEANING
#using plots: "DF3B", "DF5A", "DF5B", "DF6A", "DF6B" and "IF2A"

#exploring groups within project and plot columns
unique(raw.data$Project)
unique(raw.data$Plot)

colnames(raw.data)

data.plot.subset <- raw.data %>%
  unite("Project.Plot", Project:Plot, remove=F) %>%
    filter(Project.Plot %in% c("DF_3B", "DF_5A", "DF_5B", "DF_6A", "DF_6B", "IF_2A"))
```

```{r subset plot names, echo=F, eval=T}
#check row names of Project.Plot
unique(data.plot.subset$Project.Plot)
```
These plots were chosen out of the total 20 plots because they were the only ones that had species identifications attached to samples, which was needed for our investigation of how defaunation affects species composition. 

Next, we only selected columns that contained variables of interest:

```{r, include=F}
#subset columns/variables we want
colnames(data.plot.subset)
data.subset <- data.plot.subset %>%
  dplyr::select(Project.Plot, Plant_tag, DBH..mm., Height..meters., Type_Field, ID)

colnames(data.subset) = c("Project.Plot", "Plant_tag", "DBH_mm", "Height_m", "Veg_Type", "ID")
```

```{r column/variables, echo=F, eval=T}
colnames(data.subset)
```


We removed absent or unreasonable values from the dataset. This involved simply removing blank cells or "NAs", as well as measurements that were likely incorrect, probably as a result of improper unit conversions. Additionally, we improved uniformity in the dataset by removing samples that had a height less than 1.5m and lianas. This was because not all plots measured individuals smaller than 1.5m, and height measurements for lianas are less reliable, so we decided to only analyze trees. We also found strange instances in the data: some samples were relatively tall yet had very low DBHs (Figure __); this is probably due to some error in units. Therefore, we removed any samples that had a DBH less than 1mm and a height above 1.5m to improve accuracy.

```{r cleaning dataset & columns, include=F}
#remove data we don't want to use or is missing
data.subset <- data.subset %>%
  na.omit(DBH_mm)%>% #remove DBH with no values
  filter(Height_m > 1.49) %>% #remove specimens wit height < 1.5
  filter(Veg_Type != "Liana") %>% #remove lianas
      filter(ID != "#N/A") %>% #remove species ID called "#N/A"
      filter(ID != "") %>% #remove species ID with ""
      filter(!grepl("ECH", ID))
  
#check through columns
#Plant_tag
summary(data.subset$Plant_tag)

#DBH
summary(data.subset$DBH_mm)
#max appears reasonable!
#min seems much too small - explore further 
nrow(data.subset[data.subset$DBH_mm == 0.10,]) 
which(data.subset$DBH_mm == 0.10)
data.subset <- data.subset %>% 
  filter(DBH_mm > 1.0) # values below 1 were unreasonable for a height >1.5, most likely a unit error and the raw data will have to be examined and re-entered 
```

```{r plot of DBH vs height, echo=F, eval=T}

#Plot to examine the relationship between DBH and Height
ggplot(data.subset, aes(x = DBH_mm, y = Height_m, 
                                                   color = Project.Plot))+
  geom_point()+
  xlab("DBH (mm)") + ylab("Height (m)")+ 
  ggtitle("DBH vs. Height Comparison")+ 
  geom_smooth()
#clearly there are errors with data entry or collection
```

```{r, include=F}
#Height 
summary(data.subset$Height_m)

#Veg_Type
summary(data.subset$Veg_Type)
unique(data.subset$Veg_Type)
data.subset$Veg_Type[data.subset$Veg_Type %in% c("tree","TREE")] <- "Tree"
data.subset$Veg_Type <- ifelse (data.subset$Height_m < 2.0, "Sapling", "Tree")

```

We added in variables to support our research questions and analyses. We created two new columns: "Status" and "Distance_km"

Column name | Description | Unit | Range
---------|-------------|-------|-------
Status | Indicates whether each plot is defaunated or intact forest | Category | Defaunated - Intact
Distance_km | Distance of each plot from Mokokou | Kilometers | 8.177 - 40.224

The categorical variable, "Status", will help with data visualization, and the "Distance_km" variable will be used as a proxy from the defaunation gradient in our analyses.

``` {r add new columns, include=F}
#Add Status column - defaunated or intact forest
data.subset <- data.subset %>% 
  mutate(Status = Project.Plot)
unique(data.subset$Status)
data.subset$Status[data.subset$Status %in% c("DF_3B","DF_5A", "DF_5B", "DF_6A", "DF_6B")] <- "Defaunated"
data.subset$Status[data.subset$Status %in% c("IF_2A")] <- "Intact"
unique(data.subset$Status)

#Add distance from village column 
data.subset <- data.subset %>% 
  mutate(Distance_km = Project.Plot)
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_3B")] <- "20.195"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_5A")] <- "8.177"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_5B")] <- "9.323"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_6A")] <- "23.839"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_6B")] <- "23.839"
data.subset$Distance_km[data.subset$Distance_km %in% c("IF_2A")] <- "40.224"
data.subset$Distance_km <- as.numeric(data.subset$Distance_km)
class(data.subset$Distance_km)

#Overall summary 
summary(data.subset)
```

The new dimensions of this dataset are:

```{r, dataset dimensions, echo=F, eval=T}
dim(data.subset)
```

Our cleaned dataset looks as follows:

```{r, head/columns, echo=F, eval=T}
head(data.subset)
```

Accidental misspellings are common in datasets such as this with thousands of manual entries of complex Latin species names. This is a concern because two samples that are supposed to be the same species, but have different spellings, will not be identified as the same species in our analyses. By looking at a list of the unique species names in the dataset, we found this to be the case in several instances. Identifying these errors and correcting them was very labor intensive as this can only really be done with the human eye using personal judgment as to what names were meant to be the same. Before cleaning the species names, there were 349 "species"; after correcting for spelling mistakes, there were only 323 species. This means that 26 "species" were falsely identified prior to data cleaning.

```{r, species data cleaning, include=F}

#Species IDs
sort(unique(data.subset$ID))

#remove more lianas that were input into ID column
data.subset <- data.subset %>%
  filter(ID != "Liana undetermined",  
         ID != "Liane sp 100",
         ID != "Liane sp 130",
         ID != "Liane sp 130",
         ID != "Liane sp 18", 
         ID != "Liane sp 20",
         ID != "Liane 1",
         ID != "Liane sp 1",
         ID != "Liane sp 17",
         ID != "Liane sp 21",
          ID != "liane sp 26",
         ID !=  "Liane sp 30",
         ID != "Liane sp 40",
         ID != "Liane sp 7",
         ID != "Liane sp 71",
         ID != "Liane sp 75",
          ID != "Liane sp 91",
         ID != "Liane sp 96",
         ID != "Liane A" ,
          ID != "Liane sp 12",
         ID != "Liane sp 19" ,
         ID !="Liane sp 23",
         ID != "Liane sp 26",
         ID != "Liane sp 36",
         ID != "Liane sp 6",
          ID != "Liane sp 70",
         ID != "Liane sp 74",
         ID != "Liane sp 80",
         ID != "Liane sp 92",
         ID != "Liane undetermined"
         )

#remove "undetermined" and "tag removed" species IDs
data.subset <- data.subset %>%
  filter(ID != "undetermined" ,
         ID != "Undetermined",
         ID !=  "Undetermined sp 10",
         ID != "Undetermined sp 20",
         ID != "Undetermined sp 3",
         ID != "Undetermined sp 30",
         ID != "Undetermined sp 7",
         ID != "Tree undetermined",
         ID != "tree undetermined",
         ID != "tag removed",
          ID != "Tag removed" )

#check that all lianas, "undetermined"s, and "tag removed" are gone
sort(unique(data.subset$ID))
length(unique(data.subset$ID))
    
#correcting spelling mistakes that make the same species appear separate in the code
data.subset$ID[data.subset$ID %in% c("Afrostyrax lepidophloeus")] <- "Afrostyrax lepidophyllus"
data.subset$ID[data.subset$ID %in% c("Agellae paradoxa")] <- "Agelaea paradoxa"
data.subset$ID[data.subset$ID %in% c("Xylopia quintesi")] <- "Xylopia quintasii"
data.subset$ID[data.subset$ID %in% c("Tricoscypha acuminata")] <- "Trichoscypha acuminata"
data.subset$ID[data.subset$ID %in% c("Tricoscypha abut")] <- "Trichoscypha abut"
data.subset$ID[data.subset$ID %in% c("trichilia sp 1")] <- "Trichilia sp 1"
data.subset$ID[data.subset$ID %in% c("Tessmania africana")] <- "Tessmannia africana"
data.subset$ID[data.subset$ID %in% c("Strombosiopsis tetranda")] <- "Strombosiopsis tetrandra"
data.subset$ID[data.subset$ID %in% c("salacia sp 1")] <- "Salacia sp 1"
data.subset$ID[data.subset$ID %in% c("Pseudoposopis giletti")] <- "Pseudoprosopis gilletti"
data.subset$ID[data.subset$ID %in% c("Pentaclethra aetveldiana")] <- "Pentaclethra eetveldeana"
data.subset$ID[data.subset$ID %in% c("Pausinystalia Johimbe")] <- "Pausinystalia johimbe"
data.subset$ID[data.subset$ID %in% c("Napoleona vogelei")] <- "Napoleona vogellei"
data.subset$ID[data.subset$ID %in% c("Klaineanthus gaboni")] <- "Klaineanthus gabonii"
data.subset$ID[data.subset$ID %in% c("Greenwaydendron suavolens")] <- "Greenwayodendron suaveolens"
data.subset$ID[data.subset$ID %in% c("Garcinia afzelii")] <- "Garcinia afzelli"
data.subset$ID[data.subset$ID %in% c("Drypetes gosseweileri")] <- "Drypetes gossweileri"
data.subset$ID[data.subset$ID %in% c("Dismonanthus bentanianus")] <- "Distemonanthus benthamianus"
data.subset$ID[data.subset$ID %in% c("diospyros sp 5")] <- "Diospyros sp 5" 
data.subset$ID[data.subset$ID %in% c("diospyros sp 6")] <- "Diospyros sp 6" 
data.subset$ID[data.subset$ID %in% c("Diogua zenkeri")] <- "Diogoa zenkeri"
data.subset$ID[data.subset$ID %in% c("Dialium denclagei")] <- "Dialium dinklagei" 
data.subset$ID[data.subset$ID %in% c("Dialium bipendensis")] <- "Dialium bipindense" 
data.subset$ID[data.subset$ID %in% c("Dachriodes kleiniana")] <- "Dacryodes klaineana"
data.subset$ID[data.subset$ID %in% c("Dachriodes butineri")] <- "Dacryodes buettneri"
data.subset$ID[data.subset$ID %in% c("cola sp 1")] <- "Cola sp 1" 
data.subset$ID[data.subset$ID %in% c("Coelocaryron preussii")] <- "Coelocaryon preussii"
data.subset$ID[data.subset$ID %in% c("Chytranthus talboti")] <- "Chytranthus talbotii"
data.subset$ID[data.subset$ID %in% c("Agelaea paradoxa" )] <- "Agellae paradoxa" 
```

```{r export & read in cleaned dataset, include=F}
write.csv(data.subset, row.names = FALSE, 
          file = "../Data/Processed/Cleaned_Gabon_Forest_Plot_Data.csv")

clean.data <- read.csv("./Data/Processed/Cleaned_Gabon_Forest_Plot_Data.csv", 
                     stringsAsFactors = TRUE)
```

The dimensions of the processed, clean dataset are as follows:
```{r explore cleaned data, echo=F, eval=T}
dim(clean.data)
```

\newpage

# Exploratory Analysis 


\newpage

## Spatial Analysis

```{r creating map of Africa, include=F}

#Determine coordinate reference system & explore columns
st_crs(Africa)#WGS 84
colnames(Africa)

#Map of Africa
mapView(Africa,zcol = "ADM0_NAME")
```

```{r Map of Gabon, include=F}
#Making Gabon sf
Gabon <- Africa %>%
  filter(ADM0_NAME == 'Gabon')

#Maping Gabon
mapview(Africa, col.regions = "mediumpurple3")+ 
  mapview(Gabon, col.regions = "springgreen")

```

```{r Detailed Map of Gabon with parks, include=F}
st_crs(Parks) #Gtm_Gabon
colnames(Parks)

#change crs to WGS 84
National_Parks <- st_transform(Parks, "+proj=longlat +datum=WGS84")
st_crs(National_Parks)

#Getting Ivindo National Park by itself
Ivindo_NP <- National_Parks %>%
  filter(NOM == "IVINDO")

mapview(Gabon, col.regions = "palegreen1")+
  mapview(National_Parks, col.region = "palegreen3")+
  mapview(Ivindo_NP, col.region = "darkgreen", lwd = 1.5, color = "black")
``` 

```{r Map of Ivindo with plots, include=F}
#CRS
st_crs(Rivers)
st_crs(Roads)
st_crs(Makokou)
Makokou <- Makokou %>%
  st_as_sf(coords = c('Longitude', 'Latitude'), crs = "+proj=longlat +datum=WGS84")
Makokou_WGS84 <- st_transform(Makokou, "+proj=longlat +datum=WGS84")
st_crs(Plots) #WGS 84
colnames(Plots)

#Map Gabon with Parks and Plots
mapviewPalette(name = "mapviewVectorColors")

mapview(Ivindo_NP, col.region = "palegreen2", lwd = 1, color = "black", alpha.regions = 0.5)+
  mapview(Plots, zcol = "Plot_Name", col.region = c("magenta","red","orangered","orange","gold","yellow"), cex = 4, alpha.regions = 0.95)+
  mapview(Makokou, col.region = "black", cex = 4, alpha.regions = 0.95)

```

## DBH
```{r DBH graphs, echo=FALSE}

#basic visualization
DBHbyplot <- ggplot(clean.data, 
                    aes(x = Project.Plot, y = DBH_mm, color = Project.Plot)) +
  geom_point() + xlab("Project Plot") + ylab( "DBH in Milimeter")
print(DBHbyplot)


#checking distance  
ggplot(clean.data, aes(x = Project.Plot, y = Distance_km)) + geom_point()
#order by closest to city - DF_5A, DF_5B, DF_3B, DF_6A, DF_6B, IF_2A

ordereddata <- arrange(clean.data, Distance_km)

#wrangle data for each plotsite
DF_5A_Data <- subset(clean.data, Project.Plot== "DF_5A")
DF_5B_Data <- subset(clean.data, Project.Plot== "DF_5B")
DF_3B_Data <- subset(clean.data, Project.Plot== "DF_3B")
DF_6A_Data <- subset(clean.data, Project.Plot== "DF_6A")
DF_6B_Data <- subset(clean.data, Project.Plot== "DF_6B")
IF_2A_Data <- subset(clean.data, Project.Plot== "IF_2A")

#individual historgram full data
plot_DF_5A <- ggplot(DF_5A_Data, 
                    aes(x = DBH_mm, color=Project.Plot)) +
  geom_histogram(color= "orange") + xlab("DBH in mm") + ylab( "Frequency") + 
  ggtitle("DBH of Site DF_5A")
print(plot_DF_5A)

plot_IF_2A <- ggplot(IF_2A_Data, 
                    aes(x = DBH_mm, color=Project.Plot)) +
  geom_histogram(color = "pink") + xlab("DBH in mm") + ylab( "Frequency") + 
  ggtitle("DBH of Site IF_2A")
print(plot_IF_2A)


#individual histogram limited DBH scale
plot_DF_5A_limited <- ggplot(DF_5A_Data, 
                    aes(x = DBH_mm)) +
  geom_histogram() + xlim(0,550) +
  xlab("DBH in mm") + ylab( "Frequency") + ggtitle("DBH of Site DF_5A")
print(plot_DF_5A_limited)


#histogram of all sites
allsitesbyDBH <- ggplot(clean.data, aes(x = DBH_mm, color = Project.Plot)) +
  geom_histogram() + facet_wrap(vars(Project.Plot)) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesbyDBH)

allsitesbyDBH_limitedx <- ggplot(clean.data, aes(x = DBH_mm, color = Project.Plot)) +
  geom_histogram() + facet_wrap(vars(Project.Plot)) + xlim(0,150) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesbyDBH_limitedx)


#re-order facet_wrap by distance from city
allsitesordered <- ggplot(transform(clean.data, 
                                    Project.Plot=factor(Project.Plot, 
                                                        levels=c("DF_5A", 
                                                                 "DF_5B", 
                                                                 "DF_3B", 
                                                                 "DF_6A", 
                                                                 "DF_6B", 
                                                                 "IF_2A")))) + 
  geom_histogram(aes(x = DBH_mm, color = Project.Plot)) + 
  facet_wrap(vars(Project.Plot)) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesordered)


allsitesordered_limitedx <- ggplot(transform(clean.data, 
                                             Project.Plot=factor(Project.Plot, 
                                                                 levels=c("DF_5A", 
                                                                          "DF_5B", 
                                                                          "DF_3B", 
                                                                          "DF_6A", 
                                                                          "DF_6B", 
                                                                          "IF_2A")))) +
  geom_histogram(aes(x = DBH_mm, color = Project.Plot)) + 
  facet_wrap(vars(Project.Plot)) + xlim(0,150) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesordered_limitedx)


#otherways to determine differences in DBH per site
summary(DF_5A_Data$DBH_mm)
summary (IF_2A_Data$DBH_mm)


DBHstats <- ggplot(clean.data, 
                    aes(x = DBH_mm, color = Project.Plot)) +
  geom_bar() + xlim(0, 500) +
  xlab("DBH") + ylab( "Frequency")
print(DBHstats)



```


# Analysis

##GLMs
```{r GLM data preparation, include=F}
# derive basal area from tree DBH in terms of square cm
treedata <- mutate(clean.data, basal_area_cm = (((DBH_mm^2)*pi)/4)/100)

#summarize basal area by Project Plot
#Basal area will be in terms of square meters
SiteSummaries <- treedata %>%
  group_by(Project.Plot) %>%
  summarise(Mean_dist = mean(Distance_km),
            total_basal_area = sum(basal_area_cm),
            StDev_basal_area = sd(basal_area_cm),
            total_species = n_distinct(ID)) %>%
  mutate(total_basal_area = (total_basal_area/10000)) %>%
  mutate(basal_area_per_ha = (total_basal_area/0.25))

# Investigate basal area by species at each site
# DF_5A
DF_5A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_5A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_5A')


#DF_5B
DF_5B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_5B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_5B')
  
#DF_3B
DF_3B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_3B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_3B')

#DF_6A
DF_6A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_6A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_6A')

#DF_6B
DF_6B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_6B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_6B')

#IF_2A
IF_2A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'IF_2A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'IF_2A')

species_by_site_df <- rbind(DF_3B_basalarea, DF_5A_basalarea, DF_5B_basalarea, 
                         DF_6A_basalarea, DF_6B_basalarea, IF_2A_basalarea)

library(stringr)

species_by_site_df$genus <- word(species_by_site_df$ID, 1)

```

```{r GLM data visualization, include=F}
# What is the distribution of basal area in square cm for each tree by site?
ggplot(treedata, aes(x = basal_area_cm, fill = Project.Plot)) + 
  geom_histogram(bins = 40) +
  xlim(0,50) +
  facet_wrap(treedata$Project.Plot) +
  labs(title = "Basal area distribution of study plots")
```
So it seems like most sites are pretty not uniform, and small trees are over-represented at each location. Let's compare sites to see which site has the most species.
```{r, include=F}
species_by_plot <- ggplot(data=SiteSummaries, aes(x=Project.Plot, y=total_species, fill = Project.Plot)) +
  geom_bar(stat="identity") +
  theme(legend.position="none")

basal_area_by_plot <- ggplot(data=SiteSummaries, aes(x=Project.Plot, y=total_basal_area, fill = Project.Plot)) +
  geom_bar(stat="identity") +
  theme(legend.position="none")

library(cowplot)
plot_grid(species_by_plot, basal_area_by_plot, nrow = 2, align = 'h', rel_heights = c(1.25, 1))

```
So from this we can see that there are no great disparities between sites when it comes to species. At 146, DF_6B has the most species and at 96 DF_5B has the fewest species. Most sites have right around 100. We can also see how each site compares in terms of basal area - i.e., how densely forested each site is. IF_2A has the lowest basal area where DF_5A has the greatest at around 15 square meters per hectare. Given IF_2A's high species richness but low basal area, these data seem to suggest that IF_2A has many small trees but few large ones. Let's continue our exploration by seeing which genuses contribute the most to each site's basal area.

```{r DF_3B, include=F}
# Genus basal area at each site
#install.packages("treemapify")
library(treemapify)

# start by creating a new data frame with basal area summaries by genus (basal are in square meters per hectare)
DF_3B_basalarea$genus <- word(DF_3B_basalarea$ID, 1)
DF_3B_genus_summary <- DF_3B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

# Plot with a treemap showing the area each genus takes up at each site, extrapolated to a hectare
ggplot(DF_3B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_5A, include=F}
#DF_5A
DF_5A_basalarea$genus <- word(DF_5A_basalarea$ID, 1)
DF_5A_genus_summary <- DF_5A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_5A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_5B, include=F}
#DF_5B
DF_5B_basalarea$genus <- word(DF_5B_basalarea$ID, 1)
DF_5B_genus_summary <- DF_5B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_5B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_6A, include=F}
#DF_6A
DF_6A_basalarea$genus <- word(DF_6A_basalarea$ID, 1)
DF_6A_genus_summary <- DF_6A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_6A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_6B, include=F}
# DF_6B
DF_6B_basalarea$genus <- word(DF_6B_basalarea$ID, 1)
DF_6B_genus_summary <- DF_6B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_6B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r IF_2A, include=F}
IF_2A_basalarea$genus <- word(IF_2A_basalarea$ID, 1)
IF_2A_genus_summary <- IF_2A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(IF_2A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")

```

From these graphs we can see which genera make up the majority of basal area at each site. So how similar are these sites to one another? I wonder. ANOVA?


Let's begin to see if there is any relationship between basal area, species richness, and distance to towns (i.e., along the defaunation gradient)?.

```{r, include=F}
# Scatter plot of distance from town and basal area per acre
ggplot(SiteSummaries, aes(x = Mean_dist, y = basal_area_per_ha, color = Project.Plot)) +
  geom_point() +
  labs(title = "Basal area and distance to developed area") + 
       ylab('Mean Basal Area per hectare') +
       xlab("Distance from developed area (km)") +
  geom_smooth(method=lm, se=FALSE, col='red', size=0.5)

```

```{r, include=F}
# What about species richness as it relates to distance from towns?
# Scatter plot of distance from town and basal area per acre
ggplot(SiteSummaries, aes(x = Mean_dist, y = total_species, color = Project.Plot)) +
  geom_point() +
  labs(title = "Species richness and distance to developed area") + 
       ylab('Number of unique species') +
       xlab("Distance from developed area (km)") +
  geom_smooth(method=lm, se=FALSE, col='red', size=0.5)

```

Looking at these graphs, it doesn't appear that there's much of an obvious relationship between basal area, species richness, and distance along the defaunation gradient. Still, looks can be deceiving. Let's feed these data into a linear model to see what relationships can be statistically proved. We begin by checking for correlations among variables with a corrplot. 

```{r, include=F}
library(corrplot)
SiteSummaryNumbers <- 
  SiteSummaries %>%
  dplyr::select(Mean_dist:basal_area_per_ha)
corrplot(cor(SiteSummaryNumbers))
```


from this it appears that basal area per hectare is negatively correlated with mean distance at the same time, there appears to be a weak positive correlation between total species and mean distance. Let's build a model and see how well these correlations predict basal area and species richness.

```{r, include=F}
# Linear model describing relationship between basal area per hectare as a function of total species and distance to town. 

basal_area_lm <- lm(data = SiteSummaries, basal_area_per_ha ~ Mean_dist + total_species)
step(basal_area_lm)

summary(basal_area_lm)

# Linear model describing relationship between species richness and distance to town
species_richness_lm <- lm(data = SiteSummaries, total_species ~ Mean_dist)
summary(species_richness_lm)
```

In this linear model we use species richness and distance from developed area to predict the basal area per hectare of a given site. The null hypothesis is that there is no relationship between basal area per hectare, species richness, and distance to town. The alternative hypothesis is that either both species richness and/or distance to town will influence basal area per hectare. The results of the model (p = 0.16) indicate that no such significant (p<0.05) relationships exist in this subset of data. However, based on these observations (n = 6), there does appear to be a weak negative relationship (p = 0.09) between distance to town and basal area per hectare. According to the model, with every additional kilometer of distance there is an associated 1.3 square meter decline in basal area of forested land. Once again, these relationships are not considered significant, which means the explanatory variables included in this model are not sufficient to explain observed patterns in stand density along the defaunation gradient. There is no relationship between distance to town and species richness (p = 0.74).

## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
