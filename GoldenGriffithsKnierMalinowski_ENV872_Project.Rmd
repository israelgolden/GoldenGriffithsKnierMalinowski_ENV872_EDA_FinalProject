---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Effects of a Defaunation Gradient on Tropical Forest Structure in Ivindo National Park, Gabon"
subtitle: "https://github.com/israelgolden/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject"
author: "Tashsa Griffiths, Israel Golden, Aubrey Knier, and Mishka Malinowski"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
setwd("../GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject")

# Load your packages
library(tidyverse)
library(ggplot2)
library(sf)
library(leaflet)
library(mapview)
library(lubridate)
library(RColorBrewer)
library(raster)
library(formatR)

# Set your ggplot theme
mytheme <- theme_light() +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(mytheme)

# Load your datasets
raw.data <- read.csv("./Data/Raw/Data_USE_ME.csv")

```


# Rationale and Research Questions



\newpage

# Dataset Information

```{r dataset info}
dim(raw.data)
```


\newpage

# Exploratory Analysis 

# Data Cleaning

```{r load and subset data}
#DATA CLEANING
#using plots: "DF3B", "DF5A", "DF5B", "DF6A", "DF6B" and "IF2A"

#exploring groups within project and plot columns
unique(raw.data$Project)
unique(raw.data$Plot)

colnames(raw.data)

data.plot.subset <- raw.data %>%
  unite("Project.Plot", Project:Plot, remove=F) %>%
    filter(Project.Plot %in% c("DF_3B", "DF_5A", "DF_5B", "DF_6A", "DF_6B", "IF_2A"))

#check row names of Project.Plot
unique(data.plot.subset$Project.Plot)

#subset columns/variables we want
colnames(data.plot.subset)
data.subset <- data.plot.subset %>%
  dplyr::select(Project.Plot, Plant_tag, DBH..mm., Height..meters., Type_Field, ID)

colnames(data.subset) = c("Project.Plot", "Plant_tag", "DBH_mm", "Height_m", "Veg_Type", "ID")
colnames(data.subset)

```

```{r cleaning dataset & columns}

#remove data we don't want to use or is missing
data.subset <- data.subset %>%
  na.omit(DBH_mm)%>% #remove DBH with no values
  filter(Height_m > 1.49) %>% #remove specimens wit height < 1.5
  filter(Veg_Type != "Liana") %>% #remove lianas
      filter(ID != "#N/A") %>% #remove species ID called "#N/A"
      filter(ID != "") %>% #remove species ID with ""
      filter(!grepl("ECH", ID))
  
#check through columns
#Plant_tag
summary(data.subset$Plant_tag)

#DBH
summary(data.subset$DBH_mm)
#max appears reasonable!
#min seems much too small - explore further 
nrow(data.subset[data.subset$DBH_mm == 0.10,]) 
which(data.subset$DBH_mm == 0.10)
data.subset <- data.subset %>% 
  filter(DBH_mm > 1.0) # values below 1 were unreasonable for a height >1.5, most likely a unit error and the raw data will have to be examined and re-entered 

#Plot to examine the relationship between DBH and Height
ggplot(data.subset, aes(x = DBH_mm, y = Height_m, 
                                                   color = Project.Plot))+
  geom_point()+
  xlab("DBH (mm)") + ylab("Height (m)")+ 
  ggtitle("DBH vs. Height Comparison")+ 
  geom_smooth()
#clearly there are errors with data entry or collection

#Height 
summary(data.subset$Height_m)

#Veg_Type
summary(data.subset$Veg_Type)
unique(data.subset$Veg_Type)
data.subset$Veg_Type[data.subset$Veg_Type %in% c("tree","TREE")] <- "Tree"
data.subset$Veg_Type <- ifelse (data.subset$Height_m < 2.0, "Sapling", "Tree")

```

``` {r add new columns}
#Add Status column - defaunated or intact forest
data.subset <- data.subset %>% 
  mutate(Status = Project.Plot)
unique(data.subset$Status)
data.subset$Status[data.subset$Status %in% c("DF_3B","DF_5A", "DF_5B", "DF_6A", "DF_6B")] <- "Defaunated"
data.subset$Status[data.subset$Status %in% c("IF_2A")] <- "Intact"
unique(data.subset$Status)

#Add distance from village column 
data.subset <- data.subset %>% 
  mutate(Distance_km = Project.Plot)
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_3B")] <- "20.195"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_5A")] <- "8.177"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_5B")] <- "9.323"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_6A")] <- "23.839"
data.subset$Distance_km[data.subset$Distance_km %in% c("DF_6B")] <- "23.839"
data.subset$Distance_km[data.subset$Distance_km %in% c("IF_2A")] <- "40.224"
data.subset$Distance_km <- as.numeric(data.subset$Distance_km)
class(data.subset$Distance_km)

#Overall summary 
summary(data.subset)
dim(data.subset)
head(data.subset)

```

```{r, species data cleaning}

#Species IDs
sort(unique(data.subset$ID))

#remove more lianas that were input into ID column
data.subset <- data.subset %>%
  filter(ID != "Liana undetermined",  
         ID != "Liane sp 100",
         ID != "Liane sp 130",
         ID != "Liane sp 130",
         ID != "Liane sp 18", 
         ID != "Liane sp 20",
         ID != "Liane 1",
         ID != "Liane sp 1",
         ID != "Liane sp 17",
         ID != "Liane sp 21",
          ID != "liane sp 26",
         ID !=  "Liane sp 30",
         ID != "Liane sp 40",
         ID != "Liane sp 7",
         ID != "Liane sp 71",
         ID != "Liane sp 75",
          ID != "Liane sp 91",
         ID != "Liane sp 96",
         ID != "Liane A" ,
          ID != "Liane sp 12",
         ID != "Liane sp 19" ,
         ID !="Liane sp 23",
         ID != "Liane sp 26",
         ID != "Liane sp 36",
         ID != "Liane sp 6",
          ID != "Liane sp 70",
         ID != "Liane sp 74",
         ID != "Liane sp 80",
         ID != "Liane sp 92",
         ID != "Liane undetermined"
         )

#remove "undetermined" and "tag removed" species IDs
data.subset <- data.subset %>%
  filter(ID != "undetermined" ,
         ID != "Undetermined",
         ID !=  "Undetermined sp 10",
         ID != "Undetermined sp 20",
         ID != "Undetermined sp 3",
         ID != "Undetermined sp 30",
         ID != "Undetermined sp 7",
         ID != "Tree undetermined",
         ID != "tree undetermined",
         ID != "tag removed",
          ID != "Tag removed" )

#check that all lianas, "undetermined"s, and "tag removed" are gone
sort(unique(data.subset$ID))
length(unique(data.subset$ID))
    
#correcting spelling mistakes that make the same species appear separate in the code
data.subset$ID[data.subset$ID %in% c("Afrostyrax lepidophloeus")] <- "Afrostyrax lepidophyllus"
data.subset$ID[data.subset$ID %in% c("Agellae paradoxa")] <- "Agelaea paradoxa"
data.subset$ID[data.subset$ID %in% c("Xylopia quintesi")] <- "Xylopia quintasii"
data.subset$ID[data.subset$ID %in% c("Tricoscypha acuminata")] <- "Trichoscypha acuminata"
data.subset$ID[data.subset$ID %in% c("Tricoscypha abut")] <- "Trichoscypha abut"
data.subset$ID[data.subset$ID %in% c("trichilia sp 1")] <- "Trichilia sp 1"
data.subset$ID[data.subset$ID %in% c("Tessmania africana")] <- "Tessmannia africana"
data.subset$ID[data.subset$ID %in% c("Strombosiopsis tetranda")] <- "Strombosiopsis tetrandra"
data.subset$ID[data.subset$ID %in% c("salacia sp 1")] <- "Salacia sp 1"
data.subset$ID[data.subset$ID %in% c("Pseudoposopis giletti")] <- "Pseudoprosopis gilletti"
data.subset$ID[data.subset$ID %in% c("Pentaclethra aetveldiana")] <- "Pentaclethra eetveldeana"
data.subset$ID[data.subset$ID %in% c("Pausinystalia Johimbe")] <- "Pausinystalia johimbe"
data.subset$ID[data.subset$ID %in% c("Napoleona vogelei")] <- "Napoleona vogellei"
data.subset$ID[data.subset$ID %in% c("Klaineanthus gaboni")] <- "Klaineanthus gabonii"
data.subset$ID[data.subset$ID %in% c("Greenwaydendron suavolens")] <- "Greenwayodendron suaveolens"
data.subset$ID[data.subset$ID %in% c("Garcinia afzelii")] <- "Garcinia afzelli"
data.subset$ID[data.subset$ID %in% c("Drypetes gosseweileri")] <- "Drypetes gossweileri"
data.subset$ID[data.subset$ID %in% c("Dismonanthus bentanianus")] <- "Distemonanthus benthamianus"
data.subset$ID[data.subset$ID %in% c("diospyros sp 5")] <- "Diospyros sp 5" 
data.subset$ID[data.subset$ID %in% c("diospyros sp 6")] <- "Diospyros sp 6" 
data.subset$ID[data.subset$ID %in% c("Diogua zenkeri")] <- "Diogoa zenkeri"
data.subset$ID[data.subset$ID %in% c("Dialium denclagei")] <- "Dialium dinklagei" 
data.subset$ID[data.subset$ID %in% c("Dialium bipendensis")] <- "Dialium bipindense" 
data.subset$ID[data.subset$ID %in% c("Dachriodes kleiniana")] <- "Dacryodes klaineana"
data.subset$ID[data.subset$ID %in% c("Dachriodes butineri")] <- "Dacryodes buettneri"
data.subset$ID[data.subset$ID %in% c("cola sp 1")] <- "Cola sp 1" 
data.subset$ID[data.subset$ID %in% c("Coelocaryron preussii")] <- "Coelocaryon preussii"
data.subset$ID[data.subset$ID %in% c("Chytranthus talboti")] <- "Chytranthus talbotii"
data.subset$ID[data.subset$ID %in% c("Agelaea paradoxa" )] <- "Agellae paradoxa" 
```

```{r export & read in cleaned dataset}
write.csv(data.subset, row.names = FALSE, 
          file = "../Data/Processed/Cleaned_Gabon_Forest_Plot_Data.csv")

clean.data <- read.csv("./Data/Processed/Cleaned_Gabon_Forest_Plot_Data.csv", 
                     stringsAsFactors = TRUE)
```

```{explore cleaned data}
#basic summaries of dataset
class(clean.data)
summary(clean.data)

#dimensions of dataset
dim(clean.data)

#to view dataset
colnames(clean.data)
str(clean.data)
head(clean.data)
```

\newpage

# Spatial Analysis

```{r creating map of Africa}

Africa <- st_read('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Africa/afr_g2014_2013_0.shp')

#Determine coordinate reference system & explore columns
st_crs(Africa)#WGS 84
colnames(Africa)

#Map of Africa
mapView(Africa,zcol = "ADM0_NAME")
```

```{r Map of Gabon}
#Making Gabon sf
Gabon <- Africa %>%
  filter(ADM0_NAME == 'Gabon')

#Maping Gabon
mapview(Africa, col.regions = "mediumpurple3")+ 
  mapview(Gabon, col.regions = "springgreen")

```

```{r Detailed Map of Gabon with parks}
#Parks sf
Parks <- st_read('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Gabon/National Parks/NP_PresRes.shp')

st_crs(Parks) #Gtm_Gabon
colnames(Parks)

#change crs to WGS 84
National_Parks <- st_transform(Parks, "+proj=longlat +datum=WGS84")
st_crs(National_Parks)

#Getting Ivindo National Park by itself
Ivindo_NP <- National_Parks %>%
  filter(NOM == "IVINDO")

mapview(Gabon, col.regions = "palegreen1")+
  mapview(National_Parks, col.region = "palegreen3")+
  mapview(Ivindo_NP, col.region = "darkgreen", lwd = 1.5, color = "black")
``` 

```{r Map of Ivindo with plots}

#Rivers sf 
Rivers <- st_read('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Gabon/Stream/GAB_hydro_lineaire_principal_2013/GAB_hydro_lineaire_principal_2013.shp')
st_crs(Rivers)

#Roads sf
Roads <- st_read('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Gabon/Roads/GAB_major_roads_2013.shp')
st_crs(Roads)
  
#Makokou village
Makokou <- read_csv('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Gabon/Makokou_Coordinates.csv')%>%
  st_as_sf(coords = c('Longitude', 'Latitude'), crs = "+proj=longlat +datum=WGS84")
st_crs(Makokou)
Makokou_WGS84 <- st_transform(Makokou, "+proj=longlat +datum=WGS84")


#Plots sf
Plots <- st_read('/Users/Dell Laptop/Documents/GitHub/GoldenGriffithsKnierMalinowski_ENV872_EDA_FinalProject/Data/Spatial Files/Gabon/Plots/Plots with species/plots_with_species.shp')

#CRS
st_crs(Plots) #WGS 84
colnames(Plots)

#Map Gabon with Parks and Plots
mapviewPalette(name = "mapviewVectorColors")

mapview(Ivindo_NP, col.region = "palegreen2", lwd = 1, color = "black", alpha.regions = 0.5)+
  mapview(Plots, zcol = "Plot_Name", col.region = c("magenta","red","orangered","orange","gold","yellow"), cex = 4, alpha.regions = 0.95)+
  mapview(Makokou, col.region = "black", cex = 4, alpha.regions = 0.95)

```


# Analysis

#DBH
```{r DBH graphs, echo=FALSE}

#basic visualization
DBHbyplot <- ggplot(clean.data, 
                    aes(x = Project.Plot, y = DBH_mm, color = Project.Plot)) +
  geom_point() + xlab("Project Plot") + ylab( "DBH in Milimeter")
print(DBHbyplot)


#checking distance  
ggplot(clean.data, aes(x = Project.Plot, y = Distance_km)) + geom_point()
#order by closest to city - DF_5A, DF_5B, DF_3B, DF_6A, DF_6B, IF_2A

ordereddata <- arrange(clean.data, Distance_km)

#wrangle data for each plotsite
DF_5A_Data <- subset(clean.data, Project.Plot== "DF_5A")
DF_5B_Data <- subset(clean.data, Project.Plot== "DF_5B")
DF_3B_Data <- subset(clean.data, Project.Plot== "DF_3B")
DF_6A_Data <- subset(clean.data, Project.Plot== "DF_6A")
DF_6B_Data <- subset(clean.data, Project.Plot== "DF_6B")
IF_2A_Data <- subset(clean.data, Project.Plot== "IF_2A")

#individual historgram full data
plot_DF_5A <- ggplot(DF_5A_Data, 
                    aes(x = DBH_mm, color=Project.Plot)) +
  geom_histogram(color= "orange") + xlab("DBH in mm") + ylab( "Frequency") + 
  ggtitle("DBH of Site DF_5A")
print(plot_DF_5A)

plot_IF_2A <- ggplot(IF_2A_Data, 
                    aes(x = DBH_mm, color=Project.Plot)) +
  geom_histogram(color = "pink") + xlab("DBH in mm") + ylab( "Frequency") + 
  ggtitle("DBH of Site IF_2A")
print(plot_IF_2A)


#individual histogram limited DBH scale
plot_DF_5A_limited <- ggplot(DF_5A_Data, 
                    aes(x = DBH_mm)) +
  geom_histogram() + xlim(0,550) +
  xlab("DBH in mm") + ylab( "Frequency") + ggtitle("DBH of Site DF_5A")
print(plot_DF_5A_limited)


#histogram of all sites
allsitesbyDBH <- ggplot(clean.data, aes(x = DBH_mm, color = Project.Plot)) +
  geom_histogram() + facet_wrap(vars(Project.Plot)) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesbyDBH)

allsitesbyDBH_limitedx <- ggplot(clean.data, aes(x = DBH_mm, color = Project.Plot)) +
  geom_histogram() + facet_wrap(vars(Project.Plot)) + xlim(0,150) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesbyDBH_limitedx)


#re-order facet_wrap by distance from city
allsitesordered <- ggplot(transform(clean.data, 
                                    Project.Plot=factor(Project.Plot, 
                                                        levels=c("DF_5A", 
                                                                 "DF_5B", 
                                                                 "DF_3B", 
                                                                 "DF_6A", 
                                                                 "DF_6B", 
                                                                 "IF_2A")))) + 
  geom_histogram(aes(x = DBH_mm, color = Project.Plot)) + 
  facet_wrap(vars(Project.Plot)) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesordered)


allsitesordered_limitedx <- ggplot(transform(clean.data, 
                                             Project.Plot=factor(Project.Plot, 
                                                                 levels=c("DF_5A", 
                                                                          "DF_5B", 
                                                                          "DF_3B", 
                                                                          "DF_6A", 
                                                                          "DF_6B", 
                                                                          "IF_2A")))) +
  geom_histogram(aes(x = DBH_mm, color = Project.Plot)) + 
  facet_wrap(vars(Project.Plot)) + xlim(0,150) +
  xlab("DBH in mm") + ylab("Frequency") + ggtitle("DBH across Sites")
print(allsitesordered_limitedx)


#otherways to determine differences in DBH per site
summary(DF_5A_Data$DBH_mm)
summary (IF_2A_Data$DBH_mm)


DBHstats <- ggplot(clean.data, 
                    aes(x = DBH_mm, color = Project.Plot)) +
  geom_bar() + xlim(0, 500) +
  xlab("DBH") + ylab( "Frequency")
print(DBHstats)



```

#LMs
```{r LM data preparation}
# derive basal area from tree DBH in terms of square cm
treedata <- mutate(clean.data, basal_area_cm = (((DBH_mm^2)*pi)/4)/100)

#summarize basal area by Project Plot
#Basal area will be in terms of square meters
SiteSummaries <- treedata %>%
  group_by(Project.Plot) %>%
  summarise(Mean_dist = mean(Distance_km),
            total_basal_area = sum(basal_area_cm),
            StDev_basal_area = sd(basal_area_cm),
            total_species = n_distinct(ID)) %>%
  mutate(total_basal_area = (total_basal_area/10000)) %>%
  mutate(basal_area_per_ha = (total_basal_area/0.25))

# Investigate basal area by species at each site
# DF_5A
DF_5A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_5A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_5A')


#DF_5B
DF_5B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_5B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_5B')
  
#DF_3B
DF_3B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_3B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_3B')

#DF_6A
DF_6A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_6A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_6A')

#DF_6B
DF_6B_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'DF_6B') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'DF_6B')

#IF_2A
IF_2A_basalarea <- treedata %>%
  filter(treedata$Project.Plot == 'IF_2A') %>%
  group_by(ID) %>%
  summarise(species_basal_area = sum(basal_area_cm),
            number_of_trees = n(),
            mean_basal_area = mean(basal_area_cm)) %>%
  mutate(plot_id = 'IF_2A')

species_by_site_df <- rbind(DF_3B_basalarea, DF_5A_basalarea, DF_5B_basalarea, 
                         DF_6A_basalarea, DF_6B_basalarea, IF_2A_basalarea)

library(stringr)

species_by_site_df$genus <- word(species_by_site_df$ID, 1)

```

```{r GLM data visualization}
# What is the distribution of basal area in square cm for each tree by site?
ggplot(treedata, aes(x = basal_area_cm, fill = Project.Plot)) + 
  geom_histogram(bins = 40) +
  xlim(0,50) +
  facet_wrap(treedata$Project.Plot) +
  labs(title = "Basal area distribution of study plots")
```
So it seems like most sites are pretty not uniform, and small trees are over-represented at each location. Let's compare sites to see which site has the most species.
```{r}
species_by_plot <- ggplot(data=SiteSummaries, aes(x=Project.Plot, y=total_species, fill = Project.Plot)) +
  geom_bar(stat="identity") +
  theme(legend.position="none")

basal_area_by_plot <- ggplot(data=SiteSummaries, aes(x=Project.Plot, y=total_basal_area, fill = Project.Plot)) +
  geom_bar(stat="identity") +
  theme(legend.position="none")

library(cowplot)
plot_grid(species_by_plot, basal_area_by_plot, nrow = 2, align = 'h', rel_heights = c(1.25, 1))

```
So from this we can see that there are no great disparities between sites when it comes to species. At 146, DF_6B has the most species and at 96 DF_5B has the fewest species. Most sites have right around 100. We can also see how each site compares in terms of basal area - i.e., how densely forested each site is. IF_2A has the lowest basal area where DF_5A has the greatest at around 15 square meters per hectare. Given IF_2A's high species richness but low basal area, these data seem to suggest that IF_2A has many small trees but few large ones. Let's continue our exploration by seeing which genuses contribute the most to each site's basal area.

```{r DF_3B}
# Genus basal area at each site
#install.packages("treemapify")
library(treemapify)

# start by creating a new data frame with basal area summaries by genus (basal are in square meters per hectare)
DF_3B_basalarea$genus <- word(DF_3B_basalarea$ID, 1)
DF_3B_genus_summary <- DF_3B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

# Plot with a treemap showing the area each genus takes up at each site, extrapolated to a hectare
ggplot(DF_3B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_5A}
#DF_5A
DF_5A_basalarea$genus <- word(DF_5A_basalarea$ID, 1)
DF_5A_genus_summary <- DF_5A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_5A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_5B}
#DF_5B
DF_5B_basalarea$genus <- word(DF_5B_basalarea$ID, 1)
DF_5B_genus_summary <- DF_5B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_5B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_6A}
#DF_6A
DF_6A_basalarea$genus <- word(DF_6A_basalarea$ID, 1)
DF_6A_genus_summary <- DF_6A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_6A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r DF_6B}
# DF_6B
DF_6B_basalarea$genus <- word(DF_6B_basalarea$ID, 1)
DF_6B_genus_summary <- DF_6B_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(DF_6B_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")
```

```{r IF_2A}
IF_2A_basalarea$genus <- word(IF_2A_basalarea$ID, 1)
IF_2A_genus_summary <- IF_2A_basalarea %>%
  group_by(genus) %>%
  summarise(genus_basal_area = sum(species_basal_area))

ggplot(IF_2A_genus_summary, aes(area = genus_basal_area, fill = genus_basal_area, label = genus)) +
  geom_treemap() +
  geom_treemap_text(colour = "white",
                    place = "centre",
                    size = 15,
                    grow = TRUE) +
  scale_fill_viridis_c(option = "turbo")

```

From these graphs we can see which genera make up the majority of basal area at each site. So how similar are these sites to one another? I wonder. ANOVA?


Let's begin to see if there is any relationship between basal area, species richness, and distance to towns (i.e., along the defaunation gradient)?.

```{r}
# Scatter plot of distance from town and basal area per acre
ggplot(SiteSummaries, aes(x = Mean_dist, y = basal_area_per_ha, color = Project.Plot)) +
  geom_point() +
  labs(title = "Basal area and distance to developed area") + 
       ylab('Mean Basal Area per hectare') +
       xlab("Distance from developed area (km)") +
  geom_smooth(method=lm, se=FALSE, col='red', size=0.5)

```

```{r}
# What about species richness as it relates to distance from towns?
# Scatter plot of distance from town and basal area per acre
ggplot(SiteSummaries, aes(x = Mean_dist, y = total_species, color = Project.Plot)) +
  geom_point() +
  labs(title = "Species richness and distance to developed area") + 
       ylab('Number of unique species') +
       xlab("Distance from developed area (km)") +
  geom_smooth(method=lm, se=FALSE, col='red', size=0.5)

```

Looking at these graphs, it doesn't appear that there's much of an obvious relationship between basal area, species richness, and distance along the defaunation gradient. Still, looks can be deceiving. Let's feed these data into a linear model to see what relationships can be statistically proved. We begin by checking for correlations among variables with a corrplot. 

```{r}
library(corrplot)
SiteSummaryNumbers <- 
  SiteSummaries %>%
  dplyr::select(Mean_dist:basal_area_per_ha)
corrplot(cor(SiteSummaryNumbers))
```


from this it appears that basal area per hectare is negatively correlated with mean distance at the same time, there appears to be a weak positive correlation between total species and mean distance. Let's build a model and see how well these correlations predict basal area and species richness.

```{r}
# Linear model describing relationship between basal area per hectare as a function of total species and distance to town. 

basal_area_lm <- lm(data = SiteSummaries, basal_area_per_ha ~ Mean_dist + total_species)
step(basal_area_lm)

summary(basal_area_lm)

# Linear model describing relationship between species richness and distance to town
species_richness_lm <- lm(data = SiteSummaries, total_species ~ Mean_dist)
summary(species_richness_lm)
```

In this linear model we use species richness and distance from developed area to predict the basal area per hectare of a given site. The null hypothesis is that there is no relationship between basal area per hectare, species richness, and distance to town. The alternative hypothesis is that either both species richness and/or distance to town will influence basal area per hectare. The results of the model (p = 0.16) indicate that no such significant (p<0.05) relationships exist in this subset of data. However, based on these observations (n = 6), there does appear to be a weak negative relationship (p = 0.09) between distance to town and basal area per hectare. According to the model, with every additional kilometer of distance there is an associated 1.3 square meter decline in basal area of forested land. Once again, these relationships are not considered significant, which means the explanatory variables included in this model are not sufficient to explain observed patterns in stand density along the defaunation gradient. There is no relationship between distance to town and species richness (p = 0.74).

## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
